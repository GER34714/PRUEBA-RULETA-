<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RUEDA DE LA FORTUNA by FORTUNA PLAYâ„¢</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      text-align: center;
      background: linear-gradient(180deg, #0b0c10, #1f2833);
      color: white;
      overflow-x: hidden;
    }
    header img {
      margin-top: 15px;
      max-width: 160px;
    }
    h1 {
      font-size: 1.8rem;
      margin: 10px auto 20px;
      font-weight: bold;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 3px;
    }
    h1 span {
      text-shadow: 0 0 5px #fff, 0 0 10px currentColor, 0 0 20px currentColor;
      animation: flicker 1.5s infinite alternate;
    }
    h1 span:nth-child(3n+1) { color: #8e44ad; } /* violeta */
    h1 span:nth-child(3n+2) { color: #2ecc71; } /* verde */
    h1 span:nth-child(3n+3) { color: #f1c40f; } /* amarillo */
    @keyframes flicker {
      from { opacity: 1; }
      to { opacity: 0.8; }
    }
    .wheel-container {
      position: relative;
      width: 90vw;
      max-width: 360px;
      margin: 0 auto;
    }
    canvas {
      width: 100%;
      height: auto;
      border-radius: 50%;
      background: #fff;
      box-shadow: 0 0 15px rgba(255,255,255,0.3);
    }
    .arrow {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 0; 
      height: 0; 
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-bottom: 30px solid red;
    }
    button {
      margin-top: 20px;
      padding: 12px 18px;
      font-size: 1rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
    }
    #spinBtn { background: #f1c40f; color: black; }
    #claimBtn { background: #2ecc71; color: white; display:none; }
    #userBtn { background: #3498db; color: white; display:none; }
    button:hover { transform: scale(1.05); }
    .counter {
      margin: 30px 0;
      font-size: 1.2rem;
      font-weight: bold;
      color: #f1c40f;
    }
    footer img {
      margin: 20px auto;
      max-width: 220px;
      display: block;
    }
  </style>
</head>
<body>
  <header>
    <img src="https://iili.io/KK0Gdb4.md.webp" alt="Logo Fortuna Play">
  </header>

  <h1>
    <span>R</span><span>U</span><span>E</span><span>D</span><span>A</span>
    <span>D</span><span>E</span>
    <span>L</span><span>A</span>
    <span>F</span><span>O</span><span>R</span><span>T</span><span>U</span><span>N</span><span>A</span>
    <span>b</span><span>y</span>
    <span>F</span><span>O</span><span>R</span><span>T</span><span>U</span><span>N</span><span>A</span>
    <span>P</span><span>L</span><span>A</span><span>Y</span><span>â„¢</span>
  </h1>

  <div class="wheel-container">
    <div class="arrow"></div>
    <canvas id="wheel" width="300" height="300"></canvas>
  </div>

  <button id="spinBtn">ðŸŽ° GIRAR LA RUEDA</button>
  <button id="claimBtn">ðŸ“² RECLAMAR PREMIO</button>
  <button id="userBtn">ðŸ‘¤ QUIERO UN USUARIO</button>

  <div class="counter" id="counter"></div>

  <footer>
    <img src="https://iili.io/KK0OCrl.md.png" alt="Banner final">
  </footer>

  <script>
    const prizes = [
      "300 fichas (con carga mÃ­nima)",
      "500 fichas (con carga mÃ­nima)",
      "100 fichas (sin carga)",
      "15% extra en primera carga",
      "25% extra en segunda carga",
      "30% extra en tercera carga",
      "200 fichas (con carga mÃ­nima)",
      "SeguÃ­ participando"
    ];

    const wheel = document.getElementById("wheel");
    const ctx = wheel.getContext("2d");
    const spinBtn = document.getElementById("spinBtn");
    const claimBtn = document.getElementById("claimBtn");
    const userBtn = document.getElementById("userBtn");
    const counterEl = document.getElementById("counter");

    const cajeros = [
      "https://wa.me/5491111111111",
      "https://wa.me/5491222222222",
      "https://wa.me/5491333333333",
      "https://wa.me/5491444444444",
      "https://wa.me/5491555555555",
      "https://wa.me/5491666666666",
      "https://wa.me/5491777777777"
    ];

    let startAngle = 0;
    const arc = Math.PI * 2 / prizes.length;
    let spinTimeout = null;
    let spinAngle = 0;
    let spinTime = 0;
    let spinTimeTotal = 0;
    let todayKey = new Date().toISOString().split('T')[0];
    let cajeroAsignado = localStorage.getItem("cajero");

    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function drawRouletteWheel() {
      const shuffledPrizes = [...prizes];
      shuffle(shuffledPrizes);
      ctx.clearRect(0, 0, wheel.width, wheel.height);
      for (let i = 0; i < shuffledPrizes.length; i++) {
        const angle = startAngle + i * arc;
        ctx.fillStyle = i % 2 === 0 ? "#f39c12" : "#e67e22";
        ctx.beginPath();
        ctx.moveTo(150, 150);
        ctx.arc(150, 150, 150, angle, angle + arc, false);
        ctx.fill();
        ctx.save();
        ctx.fillStyle = "white";
        ctx.translate(150 + Math.cos(angle + arc/2) * 100,
                      150 + Math.sin(angle + arc/2) * 100);
        ctx.rotate(angle + arc/2 + Math.PI/2);
        ctx.fillText(shuffledPrizes[i], -ctx.measureText(shuffledPrizes[i]).width/2, 0);
        ctx.restore();
      }
    }

    function rotateWheel() {
      spinAngle *= 0.97;
      startAngle += spinAngle * Math.PI / 180;
      drawRouletteWheel();
      if (spinAngle > 0.2) {
        spinTimeout = requestAnimationFrame(rotateWheel);
      } else {
        stopRotateWheel();
      }
    }

    function stopRotateWheel() {
      cancelAnimationFrame(spinTimeout);
      const degrees = startAngle * 180 / Math.PI + 90;
      const arcd = arc * 180 / Math.PI;
      const index = Math.floor((360 - (degrees % 360)) / arcd);
      const prize = prizes[index];
      
      if (prize === "SeguÃ­ participando") {
        userBtn.style.display = "inline-block";
      } else {
        claimBtn.style.display = "inline-block";
        lanzarConfeti();
      }

      spinBtn.disabled = true;
      localStorage.setItem("lastSpin", todayKey);
      if (!cajeroAsignado) {
        cajeroAsignado = cajeros[Math.floor(Math.random() * cajeros.length)];
        localStorage.setItem("cajero", cajeroAsignado);
      }
      claimBtn.onclick = () => {
        const now = new Date().toLocaleString();
        const msg = `Hola, quiero reclamar mi premio de hoy: "${prize}" asignado el ${now}`;
        window.open(cajeroAsignado + "?text=" + encodeURIComponent(msg), "_blank");
      };
    }

    spinBtn.addEventListener("click", () => {
      if (localStorage.getItem("lastSpin") === todayKey) {
        alert("Ya giraste la rueda hoy. Â¡Vuelve maÃ±ana!");
        return;
      }
      spinAngle = Math.random() * 20 + 10;
      rotateWheel();
    });

    function lanzarConfeti() {
      const duration = 2 * 1000;
      const end = Date.now() + duration;
      (function frame() {
        const colors = ['#bb0000', '#ffffff', '#00bb00', '#f1c40f'];
        const confetti = document.createElement("div");
        confetti.style.position = "fixed";
        confetti.style.top = Math.random() * window.innerHeight + "px";
        confetti.style.left = Math.random() * window.innerWidth + "px";
        confetti.style.width = "8px";
        confetti.style.height = "8px";
        confetti.style.background = colors[Math.floor(Math.random()*colors.length)];
        confetti.style.borderRadius = "50%";
        document.body.appendChild(confetti);
        setTimeout(()=>confetti.remove(), 2000);
        if (Date.now() < end) requestAnimationFrame(frame);
      })();
    }

    // contador dinÃ¡mico
    function updateCounter() {
      const start = 50;
      const now = new Date();
      const minutes = now.getHours() * 60 + now.getMinutes();
      const total = start + Math.floor(minutes / 3); // 1 persona cada 3 min
      counterEl.textContent = `${total} personas ya giraron la RUEDA DE LA FORTUNA hoy ðŸŽ‰`;
    }
    setInterval(updateCounter, 60000);
    updateCounter();

    drawRouletteWheel();
  </script>
</body>
</html>
