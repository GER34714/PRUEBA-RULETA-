<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fortuna Playâ„¢</title>
  <meta name="description" content="ðŸŽ° GirÃ¡ la Rueda de la Fortuna en Fortuna Playâ„¢ y descubrÃ­ tu premio exclusivo. Â¡ProbÃ¡ suerte ahora!">
  <meta property="og:title" content="Fortuna Playâ„¢ - Rueda de la Fortuna">
  <meta property="og:description" content="ðŸŽ° GirÃ¡ la Rueda de la Fortuna en Fortuna Playâ„¢ y descubrÃ­ tu premio exclusivo. Â¡ProbÃ¡ suerte ahora!">
  <meta property="og:image" content="https://iili.io/2HT3gbg.md.png">
  <meta property="og:url" content="https://ganaencasa.org">
  <meta name="theme-color" content="#ffcc00">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: url('https://iili.io/2HT3gbg.md.png') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      text-align: center;
      overflow-x: hidden;
    }
    header {
      padding: 20px;
    }
    header img {
      width: clamp(200px, 40%, 400px);
      animation: neonPulse 2s infinite alternate;
    }
    @keyframes neonPulse {
      from { filter: drop-shadow(0 0 5px #ffcc00); }
      to { filter: drop-shadow(0 0 20px #ff6600); }
    }
    h1 {
      font-size: clamp(1.5rem, 4vw, 3rem);
      color: #ffcc00;
      text-shadow: 0 0 10px #ff6600;
    }
    .wheel-container {
      position: relative;
      margin: 20px auto;
      width: clamp(250px, 70%, 500px);
      height: clamp(250px, 70%, 500px);
    }
    canvas {
      width: 100%;
      height: 100%;
    }
    .arrow {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -100%);
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-bottom: 40px solid #ffcc00;
      filter: drop-shadow(0 0 5px #ff6600);
    }
    button {
      background: #ffcc00;
      border: none;
      padding: 15px 30px;
      font-size: 1.2rem;
      cursor: pointer;
      margin: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px #ff6600;
      transition: transform 0.2s;
    }
    button:hover {
      transform: scale(1.1);
    }
    #popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      padding: 20px;
      border: 2px solid #ffcc00;
      border-radius: 10px;
      z-index: 1000;
      box-shadow: 0 0 20px #ff6600;
    }
    #popup button {
      background: #25d366;
      box-shadow: 0 0 10px #128c7e;
    }
    #timer {
      font-size: 1.2rem;
      margin-top: 10px;
      color: #ffcc00;
      text-shadow: 0 0 5px #ff6600;
    }
    @media (max-width: 600px) {
      button {
        padding: 10px 20px;
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <img src="https://iili.io/2HT3gbg.md.png" alt="Fortuna Play Logo">
    <h1>ðŸŽ° Rueda de la Fortuna ðŸŽ°</h1>
  </header>
  <main>
    <div class="wheel-container">
      <canvas id="wheel" width="500" height="500"></canvas>
      <div class="arrow"></div>
    </div>
    <button id="spinBtn">GIRAR</button>
    <div id="timer"></div>
  </main>

  <div id="popup">
    <h2>Â¡Felicidades!</h2>
    <p id="prizeText"></p>
    <button id="whatsappBtn">Solicitar premio</button>
  </div>

  <script>
    const prizes = ["100 giros gratis", "50% extra en tu carga", "10 fichas gratis", "200 giros gratis", "Premio Misterioso"];
    const wheel = document.getElementById("wheel");
    const ctx = wheel.getContext("2d");
    const spinBtn = document.getElementById("spinBtn");
    const popup = document.getElementById("popup");
    const prizeText = document.getElementById("prizeText");
    const whatsappBtn = document.getElementById("whatsappBtn");
    const timer = document.getElementById("timer");

    // Cajeros balanceados
    const cajeros = [
      { nombre: "Joaki", numero: "5491122334455" },
      { nombre: "Facu", numero: "5491199887766" }
    ];

    function getNextCajero() {
      let index = localStorage.getItem("lastCajeroIndex") || 0;
      index = parseInt(index);
      const nextIndex = (index + 1) % cajeros.length;
      localStorage.setItem("lastCajeroIndex", nextIndex);
      return cajeros[nextIndex];
    }

    function drawWheel() {
      const numPrizes = prizes.length;
      const arcSize = (2 * Math.PI) / numPrizes;
      for (let i = 0; i < numPrizes; i++) {
        ctx.beginPath();
        ctx.fillStyle = i % 2 === 0 ? "#ffcc00" : "#ff6600";
        ctx.moveTo(250, 250);
        ctx.arc(250, 250, 250, i * arcSize, (i + 1) * arcSize);
        ctx.lineTo(250, 250);
        ctx.fill();
        ctx.save();
        ctx.translate(250, 250);
        ctx.rotate(i * arcSize + arcSize / 2);
        ctx.fillStyle = "#000";
        ctx.font = "16px Arial";
        ctx.fillText(prizes[i], 100, 10);
        ctx.restore();
      }
    }
    drawWheel();

    let spinning = false;

    spinBtn.addEventListener("click", () => {
      if (spinning) return;
      let userData = JSON.parse(localStorage.getItem("userData"));
      const now = new Date();

      if (userData && new Date(userData.lastSpin).getTime() + 24*60*60*1000 > now.getTime()) {
        alert("Ya giraste hoy. EsperÃ¡ al contador.");
        return;
      }

      spinning = true;
      const spinAngle = Math.random() * 360 + 3600;
      let start = null;

      function animate(timestamp) {
        if (!start) start = timestamp;
        const progress = timestamp - start;
        const duration = 5000;
        const angle = easeOutCubic(progress, 0, spinAngle, duration);
        ctx.clearRect(0, 0, wheel.width, wheel.height);
        ctx.save();
        ctx.translate(250, 250);
        ctx.rotate(angle * Math.PI / 180);
        ctx.translate(-250, -250);
        drawWheel();
        ctx.restore();

        if (progress < duration) {
          requestAnimationFrame(animate);
        } else {
          spinning = false;
          const finalAngle = (angle % 360) * Math.PI / 180;
          const prizeIndex = prizes.length - 1 - Math.floor((finalAngle / (2 * Math.PI)) * prizes.length);
          const prize = prizes[prizeIndex];

          // Cajero fijo balanceado
          let cajero = userData?.cajero;
          if (!cajero) {
            cajero = getNextCajero();
          }

          userData = {
            premio: prize,
            cajero: cajero,
            lastSpin: now.toISOString()
          };
          localStorage.setItem("userData", JSON.stringify(userData));

          prizeText.textContent = `Ganaste: ${prize}`;
          popup.style.display = "block";

          whatsappBtn.onclick = () => {
            window.open(`https://wa.me/${userData.cajero.numero}?text=Â¡Hola ${userData.cajero.nombre}! GanÃ© ${prize} en Fortuna Playâ„¢`, "_blank");
          };

          updateTimer();
        }
      }
      requestAnimationFrame(animate);
    });

    function easeOutCubic(t, b, c, d) {
      t /= d;
      t--;
      return c * (t * t * t + 1) + b;
    }

    function updateTimer() {
      const userData = JSON.parse(localStorage.getItem("userData"));
      if (!userData) return;
      const lastSpin = new Date(userData.lastSpin);
      const nextSpin = new Date(lastSpin.getTime() + 24*60*60*1000);

      function tick() {
        const now = new Date();
        const diff = nextSpin - now;
        if (diff <= 0) {
          timer.textContent = "Â¡Ya podÃ©s girar!";
          return;
        }
        const hours = Math.floor(diff / 1000 / 60 / 60);
        const minutes = Math.floor((diff / 1000 / 60) % 60);
        const seconds = Math.floor((diff / 1000) % 60);
        timer.textContent = `PrÃ³ximo giro en: ${hours}h ${minutes}m ${seconds}s`;
        requestAnimationFrame(tick);
      }
      tick();
    }

    updateTimer();
  </script>
</body>
</html>
