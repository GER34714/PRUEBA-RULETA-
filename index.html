<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>FORTUNA PLAY‚Ñ¢</title>
<style>
body{margin:0;font-family:Arial Black,sans-serif;text-align:center;color:#fff;background:linear-gradient(135deg,#4b0082,#ff00ff,#00ff00,#ff9900);background-size:400% 400%;animation:gradientBG 15s ease infinite}
@keyframes gradientBG{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
h1{font-size:2rem;margin:10px 0}
canvas#wheelCanvas{width:90%;max-width:400px;height:auto;margin:20px auto;display:block}
#prizesList{display:flex;flex-wrap:wrap;justify-content:center;margin:10px auto;max-width:400px}
.prizeItem{background:rgba(0,0,0,0.5);margin:5px;padding:8px 12px;border-radius:8px;font-weight:bold;min-width:130px}
button{margin:10px;padding:12px 30px;font-size:1.1rem;border:none;border-radius:50px;cursor:pointer;transition:.3s}
#spinButton{background:#ff0;color:#4b0082}
#ctaButton{background:#25D366;color:#fff;display:none}
#spinButton:hover,#ctaButton:hover{transform:scale(1.08)}
#legal{font-size:0.9rem;margin:10px 0;color:#fff}

#winnerPopup{
  position:fixed;
  top:50%;left:50%;
  transform:translate(-50%,-50%) scale(0);
  background:rgba(0,0,0,0.9);
  padding:30px 40px;
  border-radius:15px;
  color:#fff;
  font-size:1.5rem;
  font-weight:bold;
  text-align:center;
  z-index:1000;
  text-shadow:0 0 5px #fff,0 0 10px #ff0,0 0 15px #f0f;
  animation:none;
  transition:transform 0.5s cubic-bezier(0.68,-0.55,0.27,1.55);
}
#winnerPopup.show{
  transform:translate(-50%,-50%) scale(1);
  animation:winnerBounce 0.8s ease forwards, neonGlow 1.5s ease-in-out infinite alternate;
}
@keyframes winnerBounce{
  0%{transform:translate(-50%,-50%) scale(0);}
  50%{transform:translate(-50%,-50%) scale(1.2);}
  70%{transform:translate(-50%,-50%) scale(0.95);}
  100%{transform:translate(-50%,-50%) scale(1);}
}
@keyframes neonGlow{
  from{text-shadow:0 0 5px #fff,0 0 10px #ff0,0 0 15px #f0f;}
  to{text-shadow:0 0 10px #fff,0 0 20px #ff0,0 0 25px #f0f;}
}

#confetti{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999;}
</style>
</head>
<body>
<h1>üé° Rueda de la Fortuna üé°</h1>
<img src="https://iili.io/KK0Gdb4.md.webp" alt="Logo FORTUNA PLAY" style="width:200px;margin:10px auto;display:block">
<canvas id="wheelCanvas" width="400" height="400"></canvas>
<button id="spinButton">GIRAR</button>
<button id="ctaButton"></button>
<div id="prizesHeader">üéÅ Posibles premios üéÅ</div>
<div id="prizesList"></div>
<div id="legal">+18 | Juego Responsable</div>
<canvas id="confetti"></canvas>
<div id="winnerPopup"></div>

<script>
// Premios y cajeros
const prizes=[
  {text:"300 fichas (con carga m√≠nima)",emoji:"üíé"},
  {text:"500 fichas (con carga m√≠nima)",emoji:"üí∞"},
  {text:"100 fichas (sin carga)",emoji:"üéØ"},
  {text:"15% extra en primera carga",emoji:"‚ú®"},
  {text:"25% extra en segunda carga",emoji:"üéâ"},
  {text:"30% extra en tercera carga",emoji:"üèÜ"},
  {text:"200 fichas (con carga m√≠nima)",emoji:"üéÅ"},
  {text:"¬°Sigue participando!",emoji:"ü§û"}
];
const cashiers=[{nombre:'Martin',num:'5491132525913'},{nombre:'Lucas',num:'5491171334027'},{nombre:'Cami',num:'5491156349123'},{nombre:'Octavio',num:'5491173566830'},{nombre:'Joaki',num:'5491123365501'},{nombre:'Facu',num:'5491125127839'},{nombre:'Ale',num:'5492615027973'}];

let userCashier=JSON.parse(localStorage.getItem('userCashier'))||null,
    usedCashiers=JSON.parse(localStorage.getItem('usedCashiers'))||[],
    rotatingIndex=parseInt(localStorage.getItem('rotatingIndex')||"0",10);

function assignCashier(){if(userCashier)return userCashier;
  const available=cashiers.filter((_,i)=>!usedCashiers.includes(i));
  if(!available.length){usedCashiers=[];localStorage.setItem('usedCashiers',JSON.stringify(usedCashiers));return assignCashier()}
  const chosenIndex=cashiers.indexOf(available[Math.floor(Math.random()*available.length)]);
  usedCashiers.push(chosenIndex);
  localStorage.setItem('usedCashiers',JSON.stringify(usedCashiers));
  userCashier=cashiers[chosenIndex];
  localStorage.setItem('userCashier',JSON.stringify(userCashier));
  return userCashier;
}

function assignRotatingCashier(){
  const c=cashiers[rotatingIndex];
  rotatingIndex=(rotatingIndex+1)%cashiers.length;
  localStorage.setItem('rotatingIndex',rotatingIndex);
  return c;
}

// Mostrar premios
const prizesListDiv=document.getElementById('prizesList');
prizes.forEach(p=>{const div=document.createElement('div');div.className='prizeItem';div.textContent=`${p.emoji} ${p.text}`;prizesListDiv.appendChild(div);});

// Rueda
const canvas=document.getElementById('wheelCanvas'),ctx=canvas.getContext('2d'),wheelRadius=canvas.width/2;
let angle=0;
function drawWheel(){
  const num=prizes.length,arc=2*Math.PI/num;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let i=0;i<num;i++){
    const start=i*arc,end=start+arc;
    ctx.beginPath();
    ctx.moveTo(wheelRadius,wheelRadius);
    ctx.arc(wheelRadius,wheelRadius,wheelRadius,start+angle,end+angle);
    ctx.fillStyle=i%2===0?'#ffcc00':'#ff66cc';
    ctx.fill();
    ctx.strokeStyle='#fff';ctx.lineWidth=2;ctx.stroke();
    ctx.save();
    ctx.translate(wheelRadius,wheelRadius);
    ctx.rotate(start+arc/2+angle);
    ctx.fillStyle='#000';ctx.font='bold 20px Arial';ctx.textAlign='center';
    ctx.fillText(String(i+1),wheelRadius/2,10);
    ctx.restore();
  }
}
drawWheel();

// Confetti
const confCanvas=document.getElementById('confetti'),confCtx=confCanvas.getContext('2d');confCanvas.width=window.innerWidth;confCanvas.height=window.innerHeight;let confettiParticles=[];
function launchConfetti(){for(let i=0;i<150;i++){confettiParticles.push({x:Math.random()*confCanvas.width,y:Math.random()*confCanvas.height-50,r:Math.random()*6+2,dx:(Math.random()-0.5)*4,dy:Math.random()*4+1,color:`hsl(${Math.random()*360},100%,50%)`})}animateConfetti()}
function animateConfetti(){confCtx.clearRect(0,0,confCanvas.width,confCanvas.height);confettiParticles.forEach(p=>{p.x+=p.dx;p.y+=p.dy;if(p.y>confCanvas.height)p.y=0;confCtx.beginPath();confCtx.arc(p.x,p.y,p.r,0,Math.PI*2);confCtx.fillStyle=p.color;confCtx.fill()});if(confettiParticles.length>0){requestAnimationFrame(animateConfetti);confettiParticles=confettiParticles.filter(p=>p.y<confCanvas.height)}}
window.addEventListener('resize',()=>{confCanvas.width=window.innerWidth;confCanvas.height=window.innerHeight});

// Giro
document.getElementById('spinButton').addEventListener('click',()=>{
  const cta=document.getElementById('ctaButton');cta.style.display='none';cta.onclick=null;
  const popup=document.getElementById('winnerPopup');popup.classList.remove('show');
  const assignedCashier=assignCashier();
  const spinAngle=Math.random()*Math.PI*4+Math.PI*4,duration=3000,start=performance.now(),startAngle=angle;
  function animate(time){
    let elapsed=time-start;if(elapsed>duration)elapsed=duration;
    const progress=elapsed/duration;
    angle=startAngle+spinAngle*(1-Math.pow(1-progress,3));
    drawWheel();
    if(elapsed<duration)requestAnimationFrame(animate);
    else finishSpin()
  }
  function finishSpin(){
    const num=prizes.length,sector=Math.floor((angle%(2*Math.PI))/(2*Math.PI/num)),prizeObj=prizes[(num-sector+num)%num];
    if(prizeObj.text==='¬°Sigue participando!'){
      const rot=assignRotatingCashier();
      cta.textContent='Quiero mi usuario';
      cta.onclick=()=>{window.open(`https://wa.me/${rot.num}?text=${encodeURIComponent(`Hola ${rot.nombre}, me creas un usuario? Vengo de tu sitio web.`)}`,'_blank')}
      popup.textContent=`${prizeObj.emoji} ¬°Sigue participando, int√©ntalo de nuevo! ${prizeObj.emoji}`;
    } else {
      cta.textContent='Solicitar premio';
      cta.onclick=()=>{
        const nowDate=new Date().toLocaleString();
        window.open(`https://wa.me/${assignedCashier.num}?text=${encodeURIComponent(`Hola ${assignedCashier.nombre}, quisiera recibir el premio "${prizeObj.text}" ganado el ${nowDate}.`)}`,'_blank');
        launchConfetti();
      };
      popup.textContent=`üéâ ${prizeObj.emoji} ¬°Felicidades! Ganaste: ${prizeObj.text} ${prizeObj.emoji} üéâ`;
    }
    popup.classList.add('show');
    setTimeout(()=>{popup.classList.remove('show')},4000);
    cta.style.display='inline-block';
  }
  requestAnimationFrame(animate);
});
</script>
</body>
</html>
