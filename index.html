<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FORTUNA PLAY‚Ñ¢</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg, #4b006e, #d4af37);
  color: white;
  text-align: center;
  margin: 0;
  padding: 0;
}
h1 { margin-top: 20px; }
#ruleta {
  width: 300px;
  height: 300px;
  border: 10px solid #d4af37;
  border-radius: 50%;
  margin: 20px auto;
  position: relative;
  overflow: hidden;
}
#ruleta .opcion {
  width: 50%;
  height: 50%;
  position: absolute;
  top: 50%;
  left: 50%;
  transform-origin: 0% 0%;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.3);
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 14px;
  font-weight: bold;
}
#girar {
  padding: 10px 20px;
  font-size: 18px;
  background: #d4af37;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  margin-top: 20px;
}
#contador { margin-top: 10px; font-size: 16px; }
#reloj { margin-top: 5px; font-size: 16px; font-weight: bold; }

/* POPUP */
.modal {
  display: none;
  position: fixed;
  z-index: 999;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.7);
  justify-content: center;
  align-items: center;
}
.modal-content {
  background: #fff;
  color: #000;
  padding: 20px;
  border-radius: 15px;
  text-align: center;
  width: 80%;
  max-width: 400px;
}
.modal-content h2 { color: #4b006e; }
.modal button {
  margin-top: 15px;
  padding: 10px 15px;
  background: #d4af37;
  border: none;
  border-radius: 10px;
  font-size: 16px;
  cursor: pointer;
}
</style>
</head>
<body>
<h1>üé∞ FORTUNA PLAY‚Ñ¢</h1>
<div id="ruleta"></div>
<button id="girar">Girar</button>
<div id="contador">Hoy ya giraron 0 personas.</div>
<div id="reloj"></div>

<!-- POPUP -->
<div id="popup" class="modal">
  <div class="modal-content">
    <h2>üéâ Ganaste üéâ</h2>
    <p id="mensajePremio"></p>
    <p id="fechaPremio"></p>
    <p>‚ö†Ô∏è Record√° sacarle captura a esta pantalla</p>
    <p>En 24 hs pod√©s volver a girar nuevamente!</p>
    <button id="btnReclamar">Reclamar premio</button>
  </div>
</div>

<script>
// ===== PREMIOS ORDENADOS =====
const premios = [
  "100 fichas",
  "200 fichas",
  "300 fichas",
  "10% extra",
  "15% extra",
  "20% extra",
  "30% extra"
];

// ===== CAJEROS FIJOS =====
const cajeros = ["Lucas", "Cami", "Joaki", "Facu"];

// ===== DATOS DEL USUARIO =====
let userData = JSON.parse(localStorage.getItem("userData")) || { 
  lastSpin: 0, 
  cajeroAsignado: null, 
  premioGanado: null, 
  fechaPremio: null 
};

// Asignar cajero fijo si no tiene
if(!userData.cajeroAsignado){
  const aleatorio = Math.floor(Math.random()*cajeros.length);
  userData.cajeroAsignado = cajeros[aleatorio];
  localStorage.setItem("userData", JSON.stringify(userData));
}

const ms24h = 24*60*60*1000;
const girarBtn = document.getElementById("girar");

// ===== POPUP ELEMENTS =====
const popup = document.getElementById("popup");
const mensajePremio = document.getElementById("mensajePremio");
const fechaPremio = document.getElementById("fechaPremio");
const btnReclamar = document.getElementById("btnReclamar");

// ===== CONTADOR =====
const contadorDiv = document.getElementById("contador");
let contador = parseInt(localStorage.getItem("contador")) || Math.floor(Math.random()*50 + 100); // n√∫mero inicial realista
contadorDiv.innerText = `Hoy ya giraron ${contador} personas.`;

// ===== RULETA =====
const ruleta = document.getElementById("ruleta");
const numPremios = premios.length;

for(let i=0; i<numPremios; i++){
  const opcion = document.createElement("div");
  opcion.classList.add("opcion");
  opcion.style.transform = `rotate(${(360/numPremios)*i}deg) skewY(-${90 - 360/numPremios}deg)`;
  opcion.innerText = premios[i];
  ruleta.appendChild(opcion);
}

// ===== FUNCION MOSTRAR POPUP =====
function mostrarPopup() {
  mensajePremio.innerText = userData.premioGanado;
  fechaPremio.innerText = `Fecha y hora: ${userData.fechaPremio}`;
  popup.style.display = "flex";
  girarBtn.disabled = true;
  btnReclamar.onclick = () => {
    const texto = `Hola ${userData.cajeroAsignado}, gan√© ${userData.premioGanado}\n${userData.fechaPremio}`;
    const url = `https://wa.me/?text=${encodeURIComponent(texto)}`;
    window.open(url, "_blank");
  };
}

// ===== FUNCION ACTUALIZAR RELOJ =====
function actualizarReloj(){
  if(userData.lastSpin){
    const tiempoTranscurrido = Date.now() - userData.lastSpin;
    if(tiempoTranscurrido < ms24h){
      const tiempoRestante = ms24h - tiempoTranscurrido;
      const hrs = Math.floor(tiempoRestante / (1000*60*60));
      const min = Math.floor((tiempoRestante % (1000*60*60))/(1000*60));
      const seg = Math.floor((tiempoRestante % (1000*60))/1000);
      document.getElementById("reloj").innerText = `Tiempo restante: ${hrs}h ${min}m ${seg}s`;
      girarBtn.disabled = true;
      return false;
    } else {
      document.getElementById("reloj").innerText = "";
      girarBtn.disabled = false;
      return true;
    }
  }
}

// ===== REINICIAR PREMIOS DEL DIA Y CONTADOR DIARIO =====
function reiniciarDia(){
  const hoy = new Date().toDateString();
  const ultimoDia = localStorage.getItem("ultimoDia");
  if(ultimoDia !== hoy){
    localStorage.setItem("premiosDelDia", JSON.stringify([]));
    contador = Math.floor(Math.random()*50 + 100);
    localStorage.setItem("contador", contador);
    contadorDiv.innerText = `Hoy ya giraron ${contador} personas.`;
    localStorage.setItem("ultimoDia", hoy);
  }
}

// ===== VERIFICAR POPUP FIJO AL RECARGAR =====
reiniciarDia();
if(userData.premioGanado && !actualizarReloj()){
  mostrarPopup();
}

// ===== EVENTO GIRO =====
girarBtn.addEventListener("click", ()=>{
  girarBtn.disabled = true;

  // Premio aleatorio con restricciones de 20% y 30% una vez por d√≠a
  let premiosDelDia = JSON.parse(localStorage.getItem("premiosDelDia")) || [];
  const premiosPermitidos = premios.filter(p=>{
    if(["20% extra","30% extra"].includes(p)){
      return !premiosDelDia.includes(p);
    }
    return true;
  });
  const premio = premiosPermitidos[Math.floor(Math.random()*premiosPermitidos.length)];

  if(["20% extra","30% extra"].includes(premio)){
    premiosDelDia.push(premio);
    localStorage.setItem("premiosDelDia", JSON.stringify(premiosDelDia));
  }

  const fecha = new Date().toLocaleString();

  // Guardar datos del spin
  userData.lastSpin = Date.now();
  userData.premioGanado = premio;
  userData.fechaPremio = fecha;
  localStorage.setItem("userData", JSON.stringify(userData));

  // Incrementar contador ficticio (1 a 5 personas)
  const incremento = Math.floor(Math.random()*5 + 1);
  contador += incremento;
  localStorage.setItem("contador", contador);
  contadorDiv.innerText = `Hoy ya giraron ${contador} personas.`;

  mostrarPopup();

  // Actualizar reloj cada segundo
  const intervaloReloj = setInterval(()=>{
    actualizarReloj();
  }, 1000);
});
</script>
</body>
</html>
